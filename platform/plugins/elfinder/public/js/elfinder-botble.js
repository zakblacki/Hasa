document.addEventListener("core-editor-init",(function(e){e.detail.ckFinderUsing((function(e){var n,t="l1_Lw",i=e.commands.get("ckfinder"),o=e.plugins.get("FileRepository"),r=e.plugins.get("Notification"),l=e.locale.t,a=function(t){return new Promise((function(i,o){var a=function(){t?Object.keys(n.files()).length?new Promise((function(e,i){n.file(t)?e():n.request({cmd:"parents",target:t}).done((function(o){n.file(t)?e():i()})).fail((function(){i()}))})).then((function(){n.exec("open",t).done((function(){i(n)})).fail((function(e){o(n,e||"errFolderNotFound")}))})).catch((function(e){o(n,e||"errFolderNotFound")})):n.one("open",(function(){n.file(t)?i(n):o(n,"errFolderNotFound")})):i(n)};n||(n=$("<div/>").dialogelfinder({title:"File Manager",cssAutoLoad:!1,baseUrl:"./",url:window.ELFINDER_CONNECTOR_URL,startPathHash:t||void 0,useBrowserHistory:!1,autoOpen:!1,width:"80%",commandsOptions:{getfile:{oncomplete:"close",multiple:!0}},getFileCallback:function(n,t){var i,o=[];t.getUI("cwd").trigger("unselectall"),$.each(n,(function(n,i){i&&i.mime.match(/^image\//i)?o.push(t.convAbsUrl(i.url)):e.execute("link",t.convAbsUrl(i.url))})),o.length&&(i=o,e.commands.get("imageUpload").isEnabled?e.execute("imageInsert",{source:i}):r.showWarning(l("Could not insert image at the current position."),{title:l("Inserting image failed"),namespace:"ckfinder"}))}}).elfinder("instance")),a()}))};i&&(i.execute=function(){a().then((function(e){e.getUI().dialogelfinder("open")}))});var c=function(e){var i=function(e,n,i){a(t).then((function(o){var r=o.getUI();r.dialogelfinder("open"),o.exec("upload",{files:[e],target:t},void 0,t).done((function(e){e.added&&e.added.length?o.url(e.added[0].hash,{async:!0}).done((function(e){n({default:o.convAbsUrl(e)}),r.dialogelfinder("close")})).fail((function(){i("errFileNotFound")})):(i(o.i18n(e.error?e.error:"errUpload")),r.dialogelfinder("close"))})).fail((function(e){var n=o.parseError(e);i(o.i18n(n?"userabort"===n?"errAbort":n:"errUploadNoFiles"))}))})).catch((function(e,n){var t=e.parseError(n);i(e.i18n(t?"userabort"===t?"errAbort":t:"errUploadNoFiles"))}))};this.upload=function(){return new Promise((function(n,t){e.file instanceof Promise||e.file&&"function"==typeof e.file.then?e.file.then((function(e){i(e,n,t)})):i(e.file,n,t)}))},this.abort=function(){n&&n.getUI().trigger("uploadabort")}};o.createUploadAdapter=function(e){return new c(e)}}))}));